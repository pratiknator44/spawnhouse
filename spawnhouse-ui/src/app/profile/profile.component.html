<!-- cover, dp, follow, unfollow, open profile options -->
<div class="cover-picture position-relative std-box-shadow">
    <img [src]="domain.cover+user.cover" class="w-100 h-100 default-cover" style="left:0;" />

    <div *ngIf="profileFlags.loadingCover" class="bg-white text-black position-absolute t-0" style="left:50%">
        Loading...
    </div>
    <div class="w-100 h-100 position-absolute t-0">
        <div *ngIf="isUserProfile" class="badge bg-white badge-pill t-0 l-0 position-absolute m-2 cursor-pointer"
            (click)="setupImageUpload(false, imageuploadtemplate)">
            <span class="iconset icon-edit-pencil"></span> cover
        </div>

        <div style="right: 0; top:0; height: 1.5rem; width: 1.5rem;"
            class="position-absolute bg-white circle cursor-pointer" (click)="copyProfileUrl()">&nbsp;<span
                class="iconset icon-share2"></span></div>

        <div class="dp circle position-absolute b-0">
            <img [src]="domain.dp+user?.dp" class="w-100 h-100 user-default-img" loading="lazy" />
            <div class="dp-edit w-100 position-absolute t-0 cursor-pointer overflow-hidden" *ngIf="isUserProfile"
                (click)="setupImageUpload(true, imageuploadtemplate)">
                <div class="iconset icon-edit-pencil text-white text-center"
                    style="margin-top: 50%; transform: (0, -50%); font-size: 2rem;"></div>
            </div>
        </div>


        <div class="position-absolute message-add-container medq-d-none">

            <div class="btn btn-default cursor-pointer bg-white d-inline m-1 border-grey float-right mt-3"
                (click)="initMinimessage(); modalOpen(minimessageTemplate)" *ngIf="!isUserProfile"><span
                    class="iconset icon-bubbles3"></span> Message
            </div>

            <div class="btn cursor-pointer d-inline m-1 border-grey float-right mt-3"
                [ngClass]="{'btn-danger': followStatus === 'Unfollow', 'bg-white': followStatus !== 'Unfollow'}"
                *ngIf="!isUserProfile" (click)="setFollowStatus()"><span class="iconset"
                    [ngClass]="{'icon-user-plus': followStatus==='+Follow', 'icon-user-minus': followStatus==='Unfollow'}"></span>
                {{ followStatus }}</div>

            <div class="btn btn-default cursor-pointer bg-white d-inline m-1 border-grey float-right mt-3"
                *ngIf="isUserProfile" (click)="routeToEditProfile()"><span class="iconset icon-edit-pencil"></span>
                &nbsp; Profile & Account
            </div>
        </div>
    </div>
</div>

<div class="mt-3 flex-container">
    <div class="side-info bg-white flex-4">
        <div class="follow-list border-none text-black m-3">
            <h3 class="text-dark text-center"><strong>{{user?.username || ''}}</strong></h3>
            <h4 class="text-dark text-center display-6"><strong>{{((user?.fname || '')+ ' '+(user?.lname ||
                    '') | titlecase)}}</strong>
                <h6 class="d-inline display-6" *ngIf="user?.gamerType">, {{ user?.gamerType | gamerType }}</h6>
                <!-- {{ usercover | json }} -->
                <div class="h6 medq-d-block">
                    <div class="btn btn-default cursor-pointer bg-white d-inline"
                        (click)="initMinimessage(); modalOpen(minimessageTemplate)" *ngIf="!isUserProfile"><span
                            class="iconset icon-bubbles3"></span> Message</div>

                    <div class="btn cursor-pointer"
                        [ngClass]="{'btn-danger': followStatus === 'Unfollow', 'bg-white': followStatus !== 'Unfollow'}"
                        *ngIf="!isUserProfile" (click)="setFollowStatus()"><span class="iconset"
                            [ngClass]="{'icon-user-plus': followStatus==='+Follow', 'icon-user-minus': followStatus==='Unfollow'}"></span>
                        {{ followStatus }}</div>

                    <div class="badge text-theme cursor-pointer m-1" *ngIf="isUserProfile"
                        (click)="routeToEditProfile()"><span class="iconset icon-edit-pencil text-small"></span> Update
                        Profile</div>
                </div>
            </h4>

            <h4 class="medq-d-block">
                <div class="text-secondary text-center mt-1 cursor-pointer cursor-pointer">
                    <h4 class="hover-underline w-50 float-right" (click)="getFollow('Followers', followlistTemplate);">
                        {{user?.followdata?.followerCount || 0}} Followers </h4>
                    <h4 class="hover-underline" (click)="getFollow('Following',followlistTemplate);">
                        {{user?.followdata?.followingCount || 0}}
                        Following</h4>
                </div>
            </h4>
            <hr>
            <div class="text-center text-secondary text-bold font-italic" *ngIf="profileFlags.loadingGamingInfo">
                <loader2 [type]="0"></loader2>
                <br>
                Loading Gamedata
            </div>

            <div class="rounded border-grey text-center"
                *ngIf="!user.nowplaying && isUserProfile && !profileFlags.loadingGamingInfo" (click)="openGamingInfo()">
                <div class="p-1 hover-bg cursor-pointer"><span class="iconset2 icon-add h1 text-theme"></span> <span
                        class="position-relative ml-2" style="top: -0.65rem;">Now Playing</span></div>
            </div>


            <div *ngIf="user?.nowplaying">
                <sh-now-playing [npdata]="user?.nowplaying" [userid]="user._id"
                    (onRemove)="modalOpen(removeplaydatatemplate)" (onNew)="openGamingInfo()">
                </sh-now-playing>
            </div>
            <!-- <div class="text-secondary font-italic" *ngIf="(user?.gamedata || (user?.gamedata?.fav?.length === 0 && user?.gamedata?.genres?.length === 0)) && isUserProfile">
 -->

            <div class="rounded border-grey text-center mt-1"
                *ngIf="(!user?.gamedata || (user?.gamedata?.fav?.length === 0 && user?.gamedata?.genres?.length === 0)) && isUserProfile"
                (click)="routeToEditProfile()">
                <div class="p-2 hover-bg cursor-pointer"><span class="iconset2 icon-heart-o h2 text-theme"></span> <span
                        class="position-relative ml-2" style="top: -0.55rem;">My Preferences</span></div>
            </div>

            <div class="d-flex mt-3" style="font-size: 3rem;" *ngIf="user?.gamedata?.playerType">
                <div class="ml-auto text-center mr-auto iconset icon-{{type | playertype: true}} text-{{type | playertype : false : true}}"
                    *ngFor="let type of user?.gamedata?.playerType"
                    title="{{type | playertype : false : false : true}}">
                    <div style="line-height: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"
                        class="text-small">{{ type | playertype | titlecase }}</div>
                </div>
            </div>
            <div class="p-2"></div>
            <div class="mt-3" *ngIf="user?.gamedata">
                <div *ngIf="user?.gamedata?.fav?.length > 0">
                    <div>
                        <div style="font-size: 1.5rem;" class="d-inline-block"><span
                                class="iconset icon-favorite text-secondary mr-1"></span></div>
                        <h4 class="text-secondary d-inline-block">Favourites</h4>
                    </div>
                    <div class="text-theme cursor-pointer" style="word-wrap: break-word;"
                        [title]="'See who all are playing '+fav.label " [ngClass]="{'d-inline mr-2': fav.value === ''}"
                        *ngFor="let fav of tempFavGamesArray">
                        <span *ngIf="fav.value !== ''" class="iconset icon-favorite"></span>
                        {{ fav.label }}
                        <span *ngIf="fav.value === ''" class="text-black">,</span>
                    </div>
                    <label class="text-theme hover-underline cursor-pointer badge"
                        *ngIf="user?.gamedata?.fav?.length > 5 && tempFavGamesArray.length === 5"
                        (click)="showAllFavourites();"> +{{ user?.gamedata?.fav?.length - 5}} more</label>
                </div>

                <div *ngIf="user?.gamedata?.genres?.length > 0" class="mt-3">
                    <div style="font-size: 1.5rem;" class="d-inline-block"><span
                            class="iconset icon-tree text-secondary mr-1"></span></div>
                    <h4 class="text-secondary d-inline-block">Genres</h4>

                    <h5>
                        <span class="badge text-white bg-{{bg[i]}} mr-1"
                            *ngFor="let genre of user?.gamedata?.genres; let i = index"> {{ genre | gameGenre }}</span>
                    </h5>
                </div>

                <div *ngIf="user?.gamedata?.gameMode">
                    <hr>
                    <div *ngIf="user?.gamedata?.gameMode === 'story'">
                        <span class="iconset3 icon-book text-theme h5"></span> &nbsp; Prefers Story Games
                    </div>
                    <div *ngIf="user?.gamedata?.gameMode === 'competitive'">
                        <span class="iconset3 icon-trophy text-warning h5"></span> &nbsp; Prefers Competitive Gaming
                    </div>
                </div>
            </div>

            <hr>
            <div class="mt-3" *ngIf="user?.bio || user?.quote || user?.website">
                <h4 class="text-secondary d-inline-block"><span class="iconset icon-user"></span>&nbsp;About</h4>
                <div>{{user?.bio}}</div>
                <div class="text-primary hover-underline cursor-pointer" (click)="gotoWebsite(user?.website)">
                    {{user?.website}}</div>
                <label class="font-italic text-secondary">{{ user?.quote }}</label>
            </div>
        </div>

        <hr *ngIf="user?.gamedata">
    </div>

    <div class="bg-white ml-1 flex-8 mt-3">
        <div class="text-secondary text-center mt-1 cursor-pointer cursor-pointer medq-d-none d-flex"
            style="justify-content: space-evenly;">
            <h3 class="hover-bg d-inline-block rounded" (click)="getFollow('Following',followlistTemplate);">
                {{user?.followdata?.followingCount}} Following
            </h3>

            <h3 class="hover-bg d-inline-block" (click)="getFollow('Followers',followlistTemplate);">
                {{user?.followdata?.followerCount}} Followers
            </h3>
        </div>
        <!-- <hr> -->
        <sh-np-feeds [userlist]="[user._id]" *ngIf="user._id"></sh-np-feeds>
    </div>



    <ng-template #imageuploadtemplate let-modal>
        <div class="modal-header bg-theme">
            <h4 class="modal-title text-white" id="modal-basic-title">Upload a {{uploadMode === 'dp' ? 'Profile Picture'
                : 'Cover Picture'}}</h4>
            <button type="button" class="close border-none text-white" aria-label="Close"
                (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body text-center p-0 border-none">
            <sh-imageupload [imageSchema]="imageSchema" [isDisabled]="disableImageUpload" [mode]="uploadMode"
                (close)="modal.close('Save click')" (onImageRemove)="refreshImage(); modal.dismiss('Cross click');"
                (newsubmit)="submitNewImage($event); modal.close('Save click')"></sh-imageupload>

        </div>
    </ng-template>


    <ng-template #removeplaydatatemplate let-modal>
        <div class="modal-header bg-theme">
            <h4 class="modal-title text-white" id="modal-basic-title">Remove Playing Data</h4>
            <button type="button" class="close border-none text-white" aria-label="Close"
                (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body text-center">
            Would you like to add <div class="h6">{{user?.nowplaying?.game}}</div> in your favourite games list? </div>
        <div class="modal-footer p-0 border-none">
            <div class="btn btn-lite"
                (click)="removeNowPlaying(); addFavgame(user?.nowplaying, false); modal.close('Save click')">No,
                just remove</div>
            <div class="btn bg-theme text-white"
                (click)="removeNowPlaying(); addFavgame(user?.nowplaying, true); modal.close('Save click')">Yes, add
                it to <span class="iconset icon-favorite"></span> list
            </div>
        </div>
    </ng-template>





    <ng-template #followlistTemplate let-modal>
        <div class="modal-header bg-theme">
            <h4 class="modal-title text-white" id="modal-basic-title">{{followUsers?.length+'
                '+selectedFollowType}}</h4>
            <button type="button" class="close border-none text-white" aria-label="Close"
                (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body text-center p-0 border-none">

            <div class="bg-white">
                <h1 class="text-secondary h2 ml-3" *ngIf="!profileFlags.loadingFollow">{{followUsers?.length+'
                    '+selectedFollowType}}</h1>
                <div class="position-relative" style="max-height: 60vh; overflow: auto;">
                    <div class="text-secondary font-italic text-center" *ngIf="followUsers?.length === 0">You have no
                        {{selectedFollowType}}</div>
                    <div class="text-center mt-3" *ngIf="profileFlags.loadingFollow">
                        <loader2 [type]="0"></loader2><br>
                        getting intel
                    </div>
                    <div class="" style="height: 13vh;" *ngFor="let user of followUsers; let i = index">
                        <div class="row m-2 mb-0 mt-0">
                            <div class="col-4">
                                <div class="dp-big circle">
                                    <img [src]="domain.dp+user?.dp" *ngIf="user?.dp" class="w-100 h-100 circle" />
                                </div>
                            </div>
                            <div class="col-4 text-left">
                                <div class="text-theme hover-underline cursor-pointer text-truncate"
                                    (click)="routeToProfile(user._id); modal.close('Save click');">
                                    {{user.username}}
                                </div>
                                <span class="text-secondary">
                                    {{(user?.fname+' '+ user?.lname) | titlecase}}
                                </span>
                            </div>
                            <div class="col-4" *ngIf="selectedFollowType === 'Following' && isUserProfile">
                                <div class="btn btn-danger cursor-pointer"
                                    (click)="addRemoveFollower('following', user._id, i)"><span
                                        class="iconset icon-user-minus"></span> &nbsp; Unfollow</div>
                            </div>
                            <div class="col-4" *ngIf="selectedFollowType === 'Followers' && isUserProfile">
                                <div class="btn btn-light cursor-pointer" (click)="removeFollowing(user._id, i)">Remove
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="btn bg-theme text-white m-2 w-50" (click)="modal.close('Save click')">Okay</div>
                </div>

            </div>
        </div>
    </ng-template>
</div>



<ng-template #minimessageTemplate let-modal>
    <div class="modal-header bg-theme">
        <h4 class="modal-title text-white" id="modal-basic-title">Mini Message</h4>
        <button type="button" class="close border-none text-white" aria-label="Close" (click)="modal.dismiss('a')">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <sh-minimessage (fireMessage)="sendMessage($event)" [user]="minimessage?.userdata" (close)="modal.dismiss('a')">
    </sh-minimessage>
</ng-template>